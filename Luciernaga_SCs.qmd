---
title: "Luciernaga Single Colors"
format: html
---

# Load Library

```{r}
#| warning: FALSE
#| message: FALSE
library(flowCore)
library(flowWorkspace)
library(openCyto)
library(stringr)
library(data.table)
library(Luciernaga)
library(dplyr)
```

```{r}
Location <- HEULog::ExternalDriveLocate(Experiment="AlphaBeta")
Location <- file.path(Location, "SingleColors")
FCSFiles <- list.files(Location, pattern=".fcs", full.names=TRUE, recursive=FALSE)
Samples <- FCSFiles[stringr::str_detect(FCSFiles, "Reference")]
```

```{r}
ExperimentsPresent <- sub("-.*", "", basename(Samples)) |> unique()
```

```{r}
#| eval: FALSE

# Setup for data folder and ProcessedExperiments.csv
IsDataPresent <- list.files(include.dirs=TRUE)
if (!any(IsDataPresent %in% "data")){dir.create("data")}
CSVFiles <- list.files("data", pattern="VisualizedExperiments_SCs.csv")

if (length(CSVFiles) == 0){
    ProcessedExperiments <- data.frame(Experiment="Test", Date="2000-01-01")
    filename <- "VisualizedExperiments_SCs.csv"
    StorageLocation <- file.path("data", filename)
    write.csv(ProcessedExperiments, StorageLocation, row.names=FALSE)
}
```

```{r}
CSV <- paste(                                                
      "https://raw.githubusercontent.com",                  
      "DavidRach", "AlphaBeta",                   
      "main", "data", "VisualizedExperiments_SCs.csv",                              
      sep = "/") 

CSV <- "data/VisualizedExperiments_SCs.csv"

Data <- read.csv(CSV, check.names=FALSE)
AlreadyVisualized <- Data |> pull(Experiment)

#walk(.f=ExperimentVisualized, .x=ExperimentsPresent, visualized=AlreadyVisualized, files=Samples, conditions=c("Ctrl", "PPD", "SEB"), template="GatesUnmixed.csv", UnityY="Spark Blue 550-A", UnityX="Pacific Blue-A")
```

# Processing

```{r}
purrr::walk(.x=ExperimentsPresent[1], .f=SingleColorsShop, 
visualized=AlreadyVisualized, files=Samples,
template="GatesRaw.csv", AFOverlap="AutofluorescentOverlaps.csv")
```

